<div class="provents">
  <div class="card py-3 flex justify-content-between align-items-center">
    <strong>Filtrar por ano</strong>
    <p-dropdown
      [(ngModel)]="selectedYear"
      [options]="yearsList"
      optionLabel="label"
      optionValue="value"
      (onChange)="setYear()"
      styleClass="w-min"
    />
  </div>
  <div class="card">
    <strong class="text-lg">Composição da carteira</strong>
    <div class="flex gap-4 mt-5 align-items-start flex-column md:flex-row">
      <apx-chart
        #chart
        [series]="chartComOptions.series"
        [chart]="chartComOptions.chart"
        [labels]="chartComOptions.labels"
        [colors]="chartComOptions.colors"
        [legend]="chartComOptions.legend"
        [tooltip]="chartComOptions.tooltip"
        [dataLabels]="chartComOptions.dataLabels"
        [responsive]="chartComOptions.responsive"
        *ngIf="!rentLoading && (walletService.activeTab$ | async) === 1"
      >
      </apx-chart>

      <div class="w-full">
        <p-table [value]="composition">
          <ng-template pTemplate="header">
            <tr>
              <th>Classe</th>
              <th>Valores pagos</th>
            </tr>
          </ng-template>
          <ng-template pTemplate="body" let-wallet>
            <tr>
              <td class="flex gap-2 align-items-center">
                <div class="provents__indicator" [style.background]="wallet.hex"></div>
                {{ wallet.type }}
              </td>
              <td>{{ wallet.total | currency: 'BRL' }}</td>
            </tr>
          </ng-template>
        </p-table>
      </div>
    </div>
  </div>

  <div class="card">
    <strong class="text-lg">Proventos</strong>

    <div class="max-w-full overflow-hidden">
      <apx-chart
        #lineChart
        [series]="chartAportsOptions.series"
        [chart]="chartAportsOptions.chart"
        [xaxis]="chartAportsOptions.xaxis"
        [yaxis]="chartAportsOptions.yaxis"
        [stroke]="chartAportsOptions.stroke"
        [dataLabels]="chartAportsOptions.dataLabels"
        [markers]="chartAportsOptions.markers"
        [plotOptions]="chartAportsOptions.plotOptions"
        [legend]="chartAportsOptions.legend"
        [grid]="chartAportsOptions.grid"
        *ngIf="!rentLoading && (walletService.activeTab$ | async) === 1"
      >
      </apx-chart>
    </div>

    <div class="w-full mt-5" *ngIf="proventsList.length">
      <p-table
        [value]="proventsList"
        styleClass="p-datatable-gridlines p-datatable-striped"
        [(selection)]="selectedProvents"
        dataKey="id"
      >
        <ng-template pTemplate="header">
          <tr>
            <th style="width: 4rem"><p-tableHeaderCheckbox /></th>
            <th class="text-center">Produto</th>
            <th class="text-center">Tipo</th>
            <th class="text-center">Quantidade</th>
            <th class="text-center">Valor</th>
            <th class="text-center">Data pagamento</th>
            <th class="text-center">Classe</th>
            <th class="text-center">Status</th>
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-dvd>
          <tr>
            <td>
              <p-tableCheckbox
                [value]="dvd"
                [disabled]="dvd.status !== 'not_registered' || dvd.qtdAtDate <= 0"
              />
            </td>
            <td class="text-center" [pTooltip]="dvd.cod">{{ dvd.cod | ellipsis: 10 }}</td>
            <td class="text-center">{{ dvd.type.title }}</td>
            <td class="text-center">{{ dvd.qtdAtDate }}</td>
            <td class="text-center">{{ dvd.totalReceived | currency: 'BRL' }}</td>
            <td class="text-center">{{ dvd.payment_date }}</td>
            <td class="text-center">{{ dvd.typeOperation.title }}</td>
            <td class="text-center">
              <p-tag
                [severity]="
                  dvd.status === 'not_registered'
                    ? 'contrast'
                    : dvd.status === 'rent'
                      ? 'info'
                      : 'success'
                "
                [value]="
                  dvd.status === 'not_registered'
                    ? 'Não cadastrado'
                    : dvd.status === 'rent'
                      ? 'Aluguel'
                      : dvd.status === 'rrf'
                        ? 'Rendimento RF'
                        : 'Cadastrado'
                "
              />
            </td>
          </tr>
        </ng-template>
      </p-table>
      <div class="mt-4 flex justify-content-end">
        <p-button
          label="Cadastrar"
          severity="contrast"
          [disabled]="!selectedProvents.length"
          type="button"
          [loading]="savingLoader"
          (click)="registerProvents($event)"
        />
      </div>
    </div>
  </div>
</div>

<p-confirmPopup />
